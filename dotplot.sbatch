#!/bin/bash
#SBATCH -J dotplot
#SBATCH -p gpu
#SBATCH --mem=50gb
#SBATCH --time=01:00:00
#SBATCH --cpus-per-task=12
#SBATCH -o %x.log

# Print date and time
date

# Help message
if [[ $1 == "-h" ]] || [[ $1 == "--help" ]]
then
  echo "\
Creates pairwise dotplots of PSL files generated by halSynteny.
Usage: sbatch ${SLURM_JOB_NAME}.sbatch <seqFile>

Requires:
 - R (https://www.r-project.org)"
  exit 0
fi

# Load R module
module purge
module load gcc/11.3.0 openblas/0.3.20 r

# Input
# Cactus-formatted seqFile, i.e.,
# NEWICK tree
# name1 path1
# name2 path2
# ...
# nameN pathN
# seqFile: (s_lat_alignment.txt)
seqFile="s_lat_alignment.txt"
[[ -z "$1" ]] || seqFile="$1"
# Rscript file
scripts_dir="s-latissima-genome"
r_script="${SLURM_JOB_NAME}.R"
[[ -f "${scripts_dir}/${r_script}" ]] && r_script="${scripts_dir}/${r_script}"

# Run Rscript
cmd="Rscript $r_script $seqFile"
echo "$cmd"
$cmd
