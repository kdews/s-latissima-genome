#!/bin/bash
#SBATCH -J dotplot
#SBATCH -p gpu
#SBATCH --mem=50gb
#SBATCH --time=01:00:00
#SBATCH --cpus-per-task=12
#SBATCH -o %x.log

# Print date and time
date

# Help message
if [[ $1 == "-h" ]] || [[ $1 == "--help" ]]
then
  echo "\
Creates pairwise dotplots of PSL files generated by halSynteny.
Usage: sbatch ${SLURM_JOB_NAME}.sbatch <seqFile>

Requires:
 - R (https://www.r-project.org)"
  exit 0
fi

# Load R module
module purge
module load gcc/11.3.0 openblas/0.3.20 r

# Input
scripts_dir_name="s-latissima-genome"
[[ -d $scripts_dir_name ]] && scripts_dir="${scripts_dir_name}/"
# Cactus-formatted seqFile, i.e.,
# NEWICK tree
# name1 path1
# name2 path2
# ...
# nameN pathN
# seqFile: (s-latissima-genome/s_lat_alignment.txt)
seqFile="${scripts_dir}s_lat_alignment.txt"
[[ -z "$1" ]] || seqFile="$1"
# Rscript file
r_script="${scripts_dir}${SLURM_JOB_NAME}.R"

# Run Rscript
cmd="Rscript $r_script $seqFile $scripts_dir"
echo "$cmd"
$cmd
