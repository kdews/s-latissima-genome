#!/bin/bash
#SBATCH -J dotplot
#SBATCH -p gpu
#SBATCH --mem=50gb
#SBATCH --time=01:00:00
#SBATCH --cpus-per-task=12
#SBATCH -o %x.log

# Initialize script
init="s-latissima-genome/script_init.sh"
if [[ -a "$init" ]]; then source "$init"; else { echo "Init err"; exit 1; }; fi

# Script variables
R_mod_file="modules_for_Rscript.txt"

# Help message
if [[ $1 == "-h" ]] || [[ $1 == "--help" ]]
then
  echo "\
Creates pairwise dotplots of PSL files generated by halSynteny.
Usage: sbatch ${job_name}.sbatch <seqFile>

Requires:
 - R (https://www.r-project.org)"
  exit 0
fi

# Prepend scripts_dir
R_mod_file="${scripts_dir}${R_mod_file}"

# Load R module
module purge
IFS=" " read -r -a R_mods <<< "$(cat "$R_mod_file")"
module load "${R_mods[@]}"

# Input
# Cactus-formatted seqFile, i.e.,
# NEWICK tree
# name1 path1
# name2 path2
# ...
# nameN pathN
# seqFile: (s-latissima-genome/s_lat_alignment.txt)
seqFile="${scripts_dir}s_lat_alignment.txt"
[[ -z "$1" ]] || seqFile="$1"
# Rscript file
r_script="${scripts_dir}${job_name}.R"

# Run Rscript
cmd="Rscript $r_script $seqFile Saccharina_latissima $scripts_dir"
echo "$cmd"
$cmd
