#!/bin/bash
#SBATCH -J ragout
#SBATCH -p meb_largemem
#SBATCH --mem=230gb
#SBATCH --time=7-0
#SBATCH --cpus-per-task=12
#SBATCH -o %x.log

# Initialize script
init="s-latissima-genome/script_init.sh"
if [[ -a "$init" ]]; then source "$init"; else { echo "Init err"; exit 1; }; fi

# Script environment variables
recipe_file="s_lat_rag.rcp"

# Help message
if [[ $1 == "-h" ]] || [[ $1 == "--help" ]]
then
  echo "\
Runs Ragout in large assembly mode on HAL file generated by Cactus.
Usage: sbatch ${SLURM_JOB_NAME}.sbatch
Requires: Ragout (https://github.com/fenderglass/Ragout)"
  exit 0
fi

# Load Python module and Cactus virtualenv
module purge
module load gcc/12.3.0 python/3.11.4 git/2.42.0 py-pip/23.0
env_path="/home1/kdeweese/bin/cactus-bin-v2.6.7/cactus_env/bin/activate"
if [[ -a "$env_path" ]]
then
  source "$env_path"
else
  echo "Error on source of $env_path"
  exit 1
fi
# Load Ragout conda env
conda activate ragout

# Prepend scripts directory
recipe_file="${scripts_dir}${recipe_file}"

cmd="ragout -s maf -t $SLURM_CPUS_PER_TASK $recipe_file"
echo "$cmd"
$cmd
