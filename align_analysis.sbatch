#!/bin/bash
#SBATCH -J align_analysis
#SBATCH -p gpu
#SBATCH --mem=100gb
#SBATCH --time=01:00:00
#SBATCH -o %x.log

# Initialize script
init="/home1/kdeweese/scripts/s-latissima-genome/script_init.sh"
if [[ -a "$init" ]]; then source "$init"; else { echo "Init err"; exit 1; }; fi

# Script variables / defaults
# Rscript files
r_scripts=(
  "sum_psls.R"
  "align_stats.R"
  "heatmap.R"
  # "dotplot.R"
)

# seqFile
seqFile="s_lat_alignment.txt"

# Help message
if [[ $1 == "-h" ]] || [[ $1 == "--help" ]]
then
  echo "\
Summarizes and plots pairwise PSL alignment files generated by halSynteny.
Usage: sbatch ${job_name}.sbatch <seqFile>

Requires:
 - R (https://www.r-project.org)"
  exit 0
fi

# Prepend scripts_dir to files
r_scripts=("${r_scripts[@]/#/$scripts_dir}")
seqFile="${scripts_dir}${seqFile}"

# Load R module
module purge
echo "$load_R_mods"
$load_R_mods

# Input
# Cactus-formatted seqFile, i.e.,
# NEWICK tree
# name1 path1
# name2 path2
# ...
# nameN pathN
# seqFile: (s-latissima-genome/s_lat_alignment.txt)
[[ -z "$1" ]] || seqFile="$1"

# Run Rscript files sequentially
for r_script in "${r_scripts[@]}"
do
  cmd="Rscript $r_script $seqFile Saccharina_latissima $scripts_dir"
  echo "$cmd"
  $cmd
done
